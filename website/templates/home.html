{% extends "base.html" %}

{% block title %}Home - ProNearBy{% endblock %}

{% block div %}
<div class="main-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <img src="{{ url_for('static', filename=user.Image or 'assets/defualtPP.png') }}" alt="Profile Picture" class="profile-pic" />
    <h2 class="username"><span>{{ user.Name }}</span> <span>{{ user.Surname }}</span></h2>
    <p class="role">{{ user.Service }}</p>
    <p class="bio">{{ user.Bio }}</p>
    <hr />
    <p><strong>Location:</strong> {{ user.Location }}</p>
    <p><strong>Experience:</strong> {{ user.Experience }}</p>
   

    <p><strong>Availability:</strong> {{ user.availability }}</p>
    <p><strong>Rating:</strong> ⭐ {{ user.Rating }} ({{ user.Reviews }} reviews)</p>
    

    <hr class="sidebar-divider" />

    <a href="{{ url_for('views.profile', user_id=user.ID) }}" class="view-profile-btn">View Profile</a>

    <a href="{{ url_for('views.mock_feed') }}" class="browse-pros-btn">
      <i class="fas fa-stream"></i> Browse Professionals
    </a>
  </aside>

  <!-- Cards -->
  <section class="content-section">
    <!-- Example of a single card -->
    <div class="apost">
  {% for post in posts %}
  {% set post_user = post.user %}
  <div class="post-card">
    <div class="post-header">
      <img src="{{ url_for('static', filename=post_user.Image or 'assets/defualtPP.png') }}" class="post-profile-pic" alt="User Pic">
      <div class="post-user-info">
  <a href="{{ url_for('views.profile', user_id=post_user.ID) }}" class="post-user-name">
  {{ post_user.Name }} {{ post_user.Surname }}
</a>

  <span class="post-timestamp">{{ post.timestamp.strftime('%b %d, %Y %H:%M') }}</span>
</div>

      <div class="post-options">⋮</div>
    </div>

    <div class="post-body">
      <p>{{ post.content }}</p>
      {% if post.media %}
       {% for file in post.media %}
       {% if file.endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
        <img src="{{ url_for('static', filename=file) }}" class="post-img" alt="Image">
        {% elif file.endswith(('.mp4', '.mov', '.avi')) %}
         <video controls class="post-img">
          <source src="{{ url_for('static', filename=file) }}" type="video/mp4">
          Your browser does not support the video tag.
         </video>
       {% endif %}
      {% endfor %}
     {% endif %}
</div>

    <div class="post-actions">
  <form action="{{ url_for('views.like_post', post_id=post.id) }}" method="POST">

    {% set liked = post.likes.filter_by(user_id=session.get('user_id')).first() %}
<!-- Assume post.id is available and unique -->
<button class="like-button" data-post-id="{{ post.id }}">
  <img
  src="{{ url_for('static', filename='assets/LikeP.png') if post.id in liked_post_ids else url_for('static', filename='assets/like.png') }}"
  class="like-icon"
  id="like-icon-{{ post.id }}"
  alt="Like"
/>

</button>
<span id="like-count-{{ post.id }}">{{ post.like_count }}</span>

  </form>
</div>

  </div>
  {% endfor %}
</div>

    <!-- Copy the above div and change content for more cards -->
  </section>
</div>

<script>
  // Automatically fade out flash messages after 1 second
  setTimeout(() => {
    const container = document.getElementById("flash-container");
    if (container) {
      container.style.transition = "opacity 0.5s ease";
      container.style.opacity = 0;
      setTimeout(() => container.remove(), 500);  // fully remove from DOM
    }
  }, 1000);
</script>

{% endblock %}