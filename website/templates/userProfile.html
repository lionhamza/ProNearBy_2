{% extends "base.html" %}

{% block div %}



<div class="main-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2 class="username"><span>{{ user.Name }}</span> <span>{{ user.Surname }}</span></h2>
    <p class="role">{{ user.Service }}</p>
    <p class="bio">{{ user.Bio }}</p>
    <hr />
    <p><strong>Location:</strong> {{ user.Location }}</p>
    <p><strong>Experience:</strong> {{ user.Experience }}</p>
    <!---<p><strong>Contact:</strong> {{ user.CellPhone }}</p>
    <p><strong>Email:</strong> {{ user.Email }}</p>-->
    <p><strong>Availability:</strong> {{ user.availability }}</p>
    <p><strong>Rating:</strong> ⭐ {{ user.Rating }} ({{ user.Reviews }} reviews)</p>
    <hr />
    {% if user.ID == current_user_id %}
      <button class="edit-profile-btn">Edit Profile</button>
    {% else %}
      <button type="button" class="edit-profile-btn">Request Service</button>

    {% endif %}

  </aside>

  <!-- Profile container -->
  <section class="content-section">
    <div class="cardP" style="background-image: url('{{ url_for('static', filename= user.CoverImage or 'assets/DefaultCP.png') }}');">
      <div class="cardCircle">
        <img src="{{ url_for('static', filename=user.Image or 'assets/defualtPP.png') }}" alt="Profile" />
      </div>
    </div>
    {% if user.ID == current_user_id %}
  <div class="button_container">
    <button class="create_post-button">Create Post +</button>
  </div>
{% endif %}



 
   <!-- Posts Container -->
<!-- Posts -->
<div class="apost">
  {% for post in user.posts|sort(attribute='timestamp', reverse=True) %}
  <div class="post-card">
    <div class="post-header">
      <img src="{{ url_for('static', filename=user.Image or 'assets/defualtPP.png') }}" class="post-profile-pic" alt="User Pic">
      <div class="post-user-info">
        <strong>{{ user.Name }} {{ user.Surname }}</strong>
        <span class="post-timestamp">{{ post.timestamp.strftime('%b %d, %Y %H:%M') }}</span>
      </div>
      <div class="post-options">⋮</div>
    </div>

    <div class="post-body">
      <p>{{ post.content }}</p>
      {% if post.media %}
       {% for file in post.media %}
       {% if file.endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
        <img src="{{ url_for('static', filename=file) }}" class="post-img" alt="Image">
        {% elif file.endswith(('.mp4', '.mov', '.avi')) %}
         <video controls class="post-img">
          <source src="{{ url_for('static', filename=file) }}" type="video/mp4">
          Your browser does not support the video tag.
         </video>
       {% endif %}
      {% endfor %}
     {% endif %}
</div>

    <div class="post-actions">
      <button class="post-btn">❤️ Like</button>
    </div>
  </div>
  {% endfor %}
</div>


</section>

    
</div>

<!-- Edit Profile Modal -->

<!-- Create Post Modal -->


{% if user.ID == current_user_id %}
  <!-- Only include if logged-in user is viewing their own profile -->

  <!-- Edit Profile Modal -->
  <div id="editModal" class="modal">
        <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <form action="{{ url_for('views.update_profile', user_id=user.ID) }}" method="POST" enctype="multipart/form-data" class="edit-form">

      <h3>Edit Profile</h3>

      <label>Bio:</label>
      <textarea name="bio">{{ user.Bio }}</textarea>

      <label>Location:</label>
      <input type="text" name="location" value="{{ user.Location }}">

      <label>Experience:</label>
      <input type="text" name="experience" value="{{ user.Experience }}">

      <!---<label>Cell Phone:</label>
      <input type="text" name="cellphone" value="{{ user.CellPhone }}">

      <label>Email:</label>
      <input type="email" name="email" value="{{ user.Email }}">-->

      <label>Availability:</label>
      <input type="text" name="availability" value="{{ user.availability }}">

      <label>Profile Picture:</label>
      <input type="file" name="profile_pic">

      <label>Cover Picture:</label>
      <input type="file" name="cover_pic">

      <button type="submit" class="save-btn">Save</button>
    </form>
  </div>
  </div>

  <script>
    const editBtn = document.querySelector(".edit-profile-btn");
    const modal = document.getElementById("editModal");
    const closeBtn = document.getElementById("closeModal");

    editBtn.onclick = () => modal.style.display = "block";
    closeBtn.onclick = () => modal.style.display = "none";

    window.onclick = (e) => {
      if (e.target == modal) {
        modal.style.display = "none";
      }
    };
  </script>
{% endif %}



{% if user.ID == current_user_id %}
<div id="postModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closePostModal">&times;</span>
    <form action="{{ url_for('views.create_post', user_id=user.ID) }}" method="POST" enctype="multipart/form-data" class="edit-form">
      <h3>Create a Post</h3>

      <label>Say something:</label>
      <textarea name="content" placeholder="What's on your mind?" required></textarea>

      <label>Upload Media (images/videos):</label>
      <input type="file" name="post_media" accept="image/*,video/*" multiple>


      <button type="submit" class="save-btn">Post</button>
    </form>
  </div>
</div>
  <script>
  const createBtn = document.querySelector(".create_post-button");
  const postModal = document.getElementById("postModal");
  const closePostBtn = document.getElementById("closePostModal");

  createBtn.onclick = () => {
    postModal.style.display = "block";
  };

  closePostBtn.onclick = () => {
    postModal.style.display = "none";
  };

  window.onclick = (e) => {
    if (e.target == postModal) {
      postModal.style.display = "none";
    }
  };
</script>
{% endif %}


{% if user.ID != current_user_id %}
<div id="serviceRequestModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeServiceModal">&times;</span>
    <form action="{{ url_for('views.request_service') }}" method="POST" enctype="multipart/form-data" class="edit-form">
      <h3>Request a Service</h3>

      <input type="hidden" name="receiver_id" value="{{ user.ID }}">

      <label>Service Type:</label>
      <select name="service_type" required>
        <option value="">-- Select a Service --</option>
        <option value="Plumbing">Plumbing</option>
        <option value="Cleaning">Cleaning</option>
        <option value="Electrician">Electrician</option>
        <option value="Painting">Painting</option>
        <option value="Other">Other</option>
      </select>

      <label>Service (title):</label>
      <input type="text" name="service" placeholder="Short title of the request" required>

      <label>Location:</label>
      <input type="text" name="location" required>

      <label>Description:</label>
      <textarea name="description" placeholder="Briefly describe your request" required></textarea>

      <label>Upload Image (optional):</label>
      <input type="file" name="image">

      <label>Preferred Date:</label>
      <input type="date" name="preferred_date">

      <label>Preferred Time:</label>
      <input type="time" name="preferred_time">

      <button type="submit" class="save-btn">Send Request</button>
    </form>
  </div>
</div>

<script>
  const serviceBtn = document.querySelector(".edit-profile-btn");
  const serviceModal = document.getElementById("serviceRequestModal");
  const closeServiceBtn = document.getElementById("closeServiceModal");

  serviceBtn.onclick = () => serviceModal.style.display = "block";
  closeServiceBtn.onclick = () => serviceModal.style.display = "none";

  window.onclick = (e) => {
    if (e.target == serviceModal) {
      serviceModal.style.display = "none";
    }
  };
</script>
{% endif %}
{% endblock %}
