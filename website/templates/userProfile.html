{% extends "base.html" %}

{% block div %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages" id="flash-container">
     {% for category, message in messages %}
      <div class="flash-message {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>

  {% endif %}
{% endwith %}

<div class="main-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2 class="username"><span>{{ user.Name }}</span> <span>{{ user.Surname }}</span></h2>
    <p class="role">{{ user.Service }}</p>
    <p class="bio">{{ user.Bio }}</p>
    <hr />
    <p><strong>Location:</strong> {{ user.Location }}</p>
    <p><strong>Experience:</strong> {{ user.Experience }}</p>
    <!---<p><strong>Contact:</strong> {{ user.CellPhone }}</p>
    <p><strong>Email:</strong> {{ user.Email }}</p>-->
    <p><strong>Availability:</strong> {{ user.availability }}</p>
    <p><strong>Rating:</strong> ⭐ {{ user.Rating }} ({{ user.Reviews }} reviews)</p>
    <hr />
    <button class="edit-profile-btn">Edit Profile</button>
  </aside>

  <!-- Profile container -->
  <section class="content-section">
    <div class="cardP" style="background-image: url('{{ url_for('static', filename= user.CoverImage or 'assets/electricianCI.jpg') }}');">
      <div class="cardCircle">
        <img src="{{ url_for('static', filename=user.Image or 'assets/electrician.jpg') }}" alt="Profile" />
      </div>
    </div>
    <div class="button_container">
       <button class="create_post-button ">Create Post +</button>
    </div>


 
   <!-- Posts Container -->
<!-- Posts -->
<div class="apost">
  {% for post in user.posts|sort(attribute='timestamp', reverse=True) %}
  <div class="post-card">
    <div class="post-header">
      <img src="{{ url_for('static', filename=user.Image or 'assets/electrician.jpg') }}" class="post-profile-pic" alt="User Pic">
      <div class="post-user-info">
        <strong>{{ user.Name }} {{ user.Surname }}</strong>
        <span class="post-timestamp">{{ post.timestamp.strftime('%b %d, %Y %H:%M') }}</span>
      </div>
      <div class="post-options">⋮</div>
    </div>

    <div class="post-body">
      <p>{{ post.content }}</p>
      {% if post.media %}
       {% for file in post.media %}
       {% if file.endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
        <img src="{{ url_for('static', filename=file) }}" class="post-img" alt="Image">
        {% elif file.endswith(('.mp4', '.mov', '.avi')) %}
         <video controls class="post-img">
          <source src="{{ url_for('static', filename=file) }}" type="video/mp4">
          Your browser does not support the video tag.
         </video>
       {% endif %}
      {% endfor %}
     {% endif %}
</div>

    <div class="post-actions">
      <button class="post-btn">❤️ Like</button>
    </div>
  </div>
  {% endfor %}
</div>


</section>

    
</div>

<!-- Edit Profile Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <form action="{{ url_for('views.update_profile', user_id=user.ID) }}" method="POST" enctype="multipart/form-data" class="edit-form">

      <h3>Edit Profile</h3>

      <label>Bio:</label>
      <textarea name="bio">{{ user.Bio }}</textarea>

      <label>Location:</label>
      <input type="text" name="location" value="{{ user.Location }}">

      <label>Experience:</label>
      <input type="text" name="experience" value="{{ user.Experience }}">

      <!---<label>Cell Phone:</label>
      <input type="text" name="cellphone" value="{{ user.CellPhone }}">

      <label>Email:</label>
      <input type="email" name="email" value="{{ user.Email }}">-->

      <label>Availability:</label>
      <input type="text" name="availability" value="{{ user.availability }}">

      <label>Profile Picture:</label>
      <input type="file" name="profile_pic">

      <label>Cover Picture:</label>
      <input type="file" name="cover_pic">

      <button type="submit" class="save-btn">Save</button>
    </form>
  </div>
</div>

<!-- Create Post Modal -->
<div id="postModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closePostModal">&times;</span>
    <form action="{{ url_for('views.create_post', user_id=user.ID) }}" method="POST" enctype="multipart/form-data" class="edit-form">
      <h3>Create a Post</h3>

      <label>Say something:</label>
      <textarea name="content" placeholder="What's on your mind?" required></textarea>

      <label>Upload Media (images/videos):</label>
      <input type="file" name="post_media" accept="image/*,video/*" multiple>


      <button type="submit" class="save-btn">Post</button>
    </form>
  </div>
</div>

<script>
  const editBtn = document.querySelector(".edit-profile-btn");
  const modal = document.getElementById("editModal");
  const closeBtn = document.getElementById("closeModal");

  editBtn.onclick = () => {
    modal.style.display = "block";
  };

  closeBtn.onclick = () => {
    modal.style.display = "none";
  };

  window.onclick = (e) => {
    if (e.target == modal) {
      modal.style.display = "none";
    }
  };
</script>

<script>
  const createBtn = document.querySelector(".create_post-button");
  const postModal = document.getElementById("postModal");
  const closePostBtn = document.getElementById("closePostModal");

  createBtn.onclick = () => {
    postModal.style.display = "block";
  };

  closePostBtn.onclick = () => {
    postModal.style.display = "none";
  };

  window.onclick = (e) => {
    if (e.target == postModal) {
      postModal.style.display = "none";
    }
  };
</script>

<script>
  // Automatically fade out flash messages after 1 second
  setTimeout(() => {
    const container = document.getElementById("flash-container");
    if (container) {
      container.style.transition = "opacity 0.5s ease";
      container.style.opacity = 0;
      setTimeout(() => container.remove(), 500);  // fully remove from DOM
    }
  }, 1000);
</script>


{% endblock %}
